<h1>Vincular Cronograma</h1>

<%= simple_form_for @simulation_schedule, url: simulation_simulation_schedule_path(@simulation), method: :post, data: { controller: "simulation-schedule" } do |f| %>
  <div class="mb-3">
    <%= f.input :schedule_name, label: "Nome do Cronograma" %>
  </div>

  <div class="mb-3">
    <%= f.input :start_date, as: :date, label: "Data de Início", input_html: { data: { action: "input->simulation-schedule#updateEndDate", index: -1 } } %>
  </div>

  <h5>Etapas</h5>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Etapa</th>
        <th>Data de Início</th>
        <th>SLA (dias)</th>
        <th>Data de Fim</th>
      </tr>
    </thead>
    <tbody>
      <% @simulation_schedule.steps_with_defaults.each_with_index do |step, index| %>
        <tr data-simulation-schedule-target="step" data-index="<%= index %>">
          <td>
            <%= hidden_field_tag "simulation_schedule[steps][#{index}][name]", step[:name] %>
            <strong><%= step[:name] %></strong>
          </td>
          <td>
            <%= date_field_tag "simulation_schedule[steps][#{index}][start_date]", step[:start_date], class: "form-control step-start-date", data: { action: "input->simulation-schedule#updateEndDate", index: index } %>
          </td>
          <td>
            <%= number_field_tag "simulation_schedule[steps][#{index}][sla]", step[:sla], class: "form-control step-sla", min: 1, data: { action: "input->simulation-schedule#updateEndDate", index: index } %>
          </td>
          <td>
            <%= date_field_tag "simulation_schedule[steps][#{index}][end_date]", step[:end_date], class: "form-control step-end-date", readonly: true %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= f.submit "Salvar Cronograma", class: "btn btn-success mt-3" %>
<% end %>

<%= link_to "Voltar", simulation_path(@simulation), class: "btn btn-secondary mt-3" %>
